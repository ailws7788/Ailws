<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SolarTech Estimator</title>
  <link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f1f8fc; padding: 20px; color: #333; }
    .container { max-width:700px; margin:auto; background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
    h2 { text-align:center; color:#0077cc; margin-bottom:20px; }
    label,input,button { display:block; width:100%; margin-top:10px; font-size:16px; }
    input { padding:10px; border:1px solid #ccc; border-radius:6px; }
    input[readonly] { background:#eee; }
    button { margin-top:15px; background:#0077cc; color:#fff; padding:12px; border:none; border-radius:6px; cursor:pointer; }
    #output { display:none; margin-top:30px; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th,td { padding:10px; border:1px solid #ddd; }
    th { background:#f4f4f4; text-align:left; }
    #roofMap { height:400px; width:100%; border:1px solid #ccc; border-radius:8px; margin-top:20px; }
  </style>
</head>
<body>

  <div class="container">
    <div style="text-align:center;">
      <img src="logo.jpg"
           onerror="this.onerror=null; this.src='images/logo.png';"
           alt="SolarTech Logo"
           style="max-width:160px; border-radius:10px; margin-bottom:10px;"/>
      <h2>üîÜ Solar Savings Estimator</h2>
    </div>

    <div id="formArea">
      <label for="customer">Customer Name:</label>
      <input id="customer" placeholder="e.g. John Tan" type="text"/>

      <label for="location">Installation Location:</label>
      <input id="location" placeholder="Detecting..." readonly type="text"/>

      <label for="bill">Enter your monthly TNB bill (RM):</label>
      <input id="bill" placeholder="e.g. 600" type="number"/>

      <button onclick="calculate()">Calculate &amp; Draw Panels</button>
    </div>

    <div id="output"></div>
  </div>

  <div id="roofMap"></div>
      `;

      setTimeout(() => {
        const match = location.match(/\(([-\d.]+),\s*([-\d.]+)\)/);
        if (match) {
          const lat = parseFloat(match[1]);
          const lng = parseFloat(match[2]);
          const map = L.map('roofMap').setView([lat, lng], 22);
          const mapboxToken = 'pk.eyJ1IjoibWFjY2hlYW5nNzY4NyIsImEiOiJjbWM3ZHB0cnMwa2ozMm9xMjV6YmM1Mnc0In0.9OOlFHdyLY7SlPphMQt6XQ';
          L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=${mapboxToken}`, {
            tileSize: 512,
            zoomOffset: -1,
            attribution: '&copy; <a href="https://www.mapbox.com/">Mapbox</a>'
          }).addTo(map);
          L.marker([lat, lng]).addTo(map).bindPopup("Your Roof").openPopup();
const total = panelCount;
const panelLat = 1.0983783783783784e-05;
const panelLng = 2.1999760469879377e-05;
const perRow = 2;
const rows = Math.ceil(total / perRow);
for (let r = 0; r < rows; r++) {
  for (let c = 0; c < perRow; c++) {
    const index = r * perRow + c;
    if (index >= total) break;
    const offsetLat = lat - (r * panelLat);
    const offsetLng = lng + (c * panelLng);
    const bounds = [
      [offsetLat, offsetLng],
      [offsetLat + panelLat, offsetLng + panelLng]
    ];
    L.imageOverlay('https://i.imgur.com/VV3lhCl.png', bounds, {
      opacity: 0.9,
      interactive: false
    }).addTo(map);
  }
}

    map.scrollWheelZoom.enable();
    map.touchZoom.enable();
    map.dragging.enable();
    L.control.zoom({ position: 'topright' }).addTo(map);
        }
      }, 300);
    }
  </script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const center = map.getCenter();
  const north = [center.lat + 0.0005, center.lng];
  const south = [center.lat - 0.0005, center.lng];

  L.polyline([south, north], {color: 'black', weight: 4, dashArray: '2,8'}).addTo(map);
  L.marker(north, {
  icon: L.divIcon({
    className: 'arrow-labels',
    html: '<div style="font-size:38px;font-weight:bold;color:red;text-align:center;">‚Üë<br><span style="font-size:14px;">North</span></div>'
  })
}).addTo(map);
  L.marker(south, {
  icon: L.divIcon({
    className: 'arrow-labels',
    html: '<div style="font-size:38px;font-weight:bold;color:red;text-align:center;">‚Üì<br><span style="font-size:14px;">South</span></div>'
  })
}).addTo(map);
});</script><script>
document.addEventListener('DOMContentLoaded', function () {
  const lat = 4.568071;
  const lng = 101.128368;

  map.setView([lat, lng], 21);
  L.marker([lat, lng]).addTo(map).bindPopup("Â±ãÈ°∂‰∏≠ÂøÉ").openPopup();

  // ÁªòÂà∂ÂçóÂåóÊñπÂêëÊ†áÁ∫ø
  const north = [lat + 0.0005, lng];
  const south = [lat - 0.0005, lng];
  L.polyline([south, north], {color: 'red', weight: 2, dashArray: '5,5'}).addTo(map);
  L.marker(north, {icon: L.divIcon({className: 'arrow-labels', html: '<div style="font-size: 28px; font-weight: bold; color: black;">‚Üë</div>'})}).addTo(map);
  L.marker(south, {icon: L.divIcon({className: 'arrow-labels', html: '<div style="font-size: 28px; font-weight: bold; color: black;">‚Üì</div>'})}).addTo(map);

  const total = panelCount || 12;
  const panelLat = 0.00006;
  const panelLng = 0.00006;
  const perRow = 2;
  const rows = Math.ceil(total / perRow);

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < perRow; c++) {
      const index = r * perRow + c;
      if (index >= total) break;

      const offsetLat = lat - (r * panelLat);
      const offsetLng = lng + (c * panelLng);

      const bounds = [
        [offsetLat, offsetLng],
        [offsetLat + panelLat, offsetLng + panelLng]
      ];
      L.imageOverlay('https://i.imgur.com/VV3lhCl.png', bounds, {
        opacity: 0.9,
        interactive: false
      }).addTo(map);
    }
  }
});</script></body>
</html>
